# Варианты запуска сервиса

## 1. Получение сырых данных

### Переменные окружения:
- `CHECK_GAP_SECONDS` - промежуток времени, раз в который сервис будет проводить опрос метеостанции о погоде.
- `CONNECTION_IDLE_TIME_SEC` - максимальное время бездействия при подключении к БД.
- `POSTGRES_MAX_CONNECTIONS` - максимальное количество сессий БД.
- `POSTGRESQL_URL` - DNS БД.
- `WEATHER_STATION_BASE_URL` - ссылка на API метеостанции (за сегодняшний или прошлые дни).
- `CHECK_FAILED_TIME_GAP_SECONDS` - промежуток времени, раз в который сервис будет проводить опрос по времени, за которое он не смог получить данные от метеостанции.

### Описание работы:
Через каждый промежуток времени, указанный в переменной окружения `CHECK_GAP_SECONDS`, сервис делает запрос на метеостанцию и записывает данные от неё в таблицу `weather_data_raw`.

Если запрос сделать не получилось (метеостанция часто выдаёт 404), то время, за которое сервис не смог получить данные, отправляется в "бэк-лог". Данные о времени из "бэк-лога" сервис получает каждый промежуток времени, указанный в переменной окружения `CHECK_FAILED_TIME_GAP_SECONDS`, и очищает "бэк-лог".

---

## 2. Ручной запуск

### Переменные окружения:
- `CONNECTION_IDLE_TIME_SEC` - максимальное время бездействия при подключении к БД.
- `POSTGRES_MAX_CONNECTIONS` - максимальное количество сессий БД.
- `POSTGRESQL_URL` - DNS БД.
- `TIME_FROM` - временной промежуток, за который нужно получить данные (например, `2024-12-09 00:00`).
- `TIME_TO` - временной промежуток, за который нужно получить данные (например, `2024-12-10 00:00`).
- `WEATHER_STATION_BASE_URL` - ссылка на API метеостанции (за сегодняшний или прошлые дни).

### Описание работы:
Сервис можно запустить в ручном режиме, указав переменные окружения `TIME_FROM` и `TIME_TO` в формате `YYYY-MM-DD hh:mm`. Сервис соберёт данные за указанный период и сохранит их в БД, после чего завершит работу.

---

## 3. Подсчёт среднего значения за день и прогноз погоды

### Переменные окружения:
- `FORECAST_API_TOKEN` - токен для API метеостанции с прогнозом погоды.
- `FORECAST_BASE_URL` - ссылка на API метеостанции с прогнозом погоды.
- `POSTGRES_MAX_CONNECTIONS` - максимальное количество сессий БД.
- `POSTGRESQL_URL` - DNS БД.
- `CONNECTION_IDLE_TIME_SEC` - максимальное время бездействия при подключении к БД.

### Описание работы:
Сервис высчитывает среднее значение, записанное в таблице `weather_data_raw`, и сохраняет его в таблицу `weather_data`.

Запуск должен происходить раз в сутки (чем ближе к концу дня, тем лучше, так как данные будут более актуальны). Также сервис собирает данные о прогнозе погоды через API и записывает их в ту же таблицу.
